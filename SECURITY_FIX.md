# üîí –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

## –ü—Ä–æ–±–ª–µ–º–∞

–°—Ç—É–¥–µ–Ω—Ç—ã –ø–æ–ª—É—á–∏–ª–∏ –¥–æ—Å—Ç—É–ø –∫ API-—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏ –ø—Ä–æctor–æ–≤.

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–µ–π (Role-Based Access Control - RBAC).

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. **`lib/api-permissions.ts`** (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ API-—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
   - –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç endpoints –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:
     - `ADMIN_ONLY_ENDPOINTS` - —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
     - `PROCTOR_OR_HIGHER_ENDPOINTS` - –¥–ª—è –ø—Ä–æctor–æ–≤ –∏ –≤—ã—à–µ
     - `STUDENT_ENDPOINTS` - –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
     - `PUBLIC_ENDPOINTS` - –¥–ª—è –≤—Å–µ—Ö –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
   - –§—É–Ω–∫—Ü–∏—è `hasPermission()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –§—É–Ω–∫—Ü–∏—è `getAllowedRoles()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π

2. **`app/api/proxy/[...path]/route.ts`**
   - –î–æ–±–∞–≤–ª–µ–Ω import —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–µ—Å—Å–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 171-185)
   - –¢–µ–ø–µ—Ä—å –∑–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Å 403 Forbidden –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –ø—Ä–∞–≤

## –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints

### Admin only:

- `api/get-users-by-role` - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ä–æ–ª–∏
- `api/delete-user` - —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `api/add-student` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞
- `api/edit-student` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞
- `api/get-students` - —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- `api/get-unsigned-proctors-students` - –Ω–µ–∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- –∏ –¥—Ä—É–≥–∏–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### Proctor/Admin/Supervisor:

- `api/get-all-zaps` - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –æ—Ç–≥—É–ª
- `api/process-zap` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –æ—Ç–≥—É–ª
- `api/get-zap/*` - –¥–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–∞

### Student only:

- `api/get-zaps-student` - —Å–≤–æ–∏ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –æ—Ç–≥—É–ª
- `api/create-zap` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
- `api/get-homeworks-student` - —Å–≤–æ–∏ –¥–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
- `api/pass_homework` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –î–ó

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```bash
# –°—Ç—É–¥–µ–Ω—Ç –º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω—Å–∫–∏–º –¥–∞–Ω–Ω—ã–º
curl -b cookies.txt "https://nickly24-cpm-app2-e01c.twc1.net/api/proxy/api/get-all-zaps?backend=main"
# –í–æ–∑–≤—Ä–∞—â–∞–ª –¥–∞–Ω–Ω—ã–µ ‚úÖ
```

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```bash
# –¢–µ–ø–µ—Ä—å —Å—Ç—É–¥–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç 403
curl -b cookies.txt "https://nickly24-cpm-app2-e01c.twc1.net/api/proxy/api/get-all-zaps?backend=main"
# {"error":"Forbidden","message":"Access denied. Required roles: proctor, admin, supervisor","user_role":"student"}
# 403 Forbidden ‚úÖ –ë–õ–û–ö–ò–†–£–ï–¢–°–Ø
```

## –î–µ–ø–ª–æ–π

–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤ production:

1. Push –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –î–æ–∂–¥–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞ Timeweb Cloud
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É:
   - –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ —Å—Ç—É–¥–µ–Ω—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–¥–µ–ª–∞—Ç—å API-–∑–∞–ø—Ä–æ—Å—ã –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º endpoints
   - –î–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å 403 Forbidden

## –£–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –≤ –±—É–¥—É—â–µ–º:

1. **Rate limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
2. **Audit logging** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –¥–æ—Å—Ç—É–ø–∞
3. **CSRF protection** - –∑–∞—â–∏—Ç–∞ –æ—Ç –º–µ–∂—Å–∞–π—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
4. **Session management** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π logout –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## –°—Ç–∞—Ç—É—Å

‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** - –¥–æ–±–∞–≤–ª–µ–Ω RBAC –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞
